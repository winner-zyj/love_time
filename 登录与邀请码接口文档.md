# 登录与邀请码接口文档

## 基础信息

- **基础 URL**：`http://192.168.224.229:8886`（开发环境）
- **认证方式**：登录接口无需 token，其他接口需在请求头携带 `Authorization: Bearer {token}`
- **统一响应格式**：
```json
{
  "success": true,
  "message": "操作成功",
  "data": {}
}
```

---

## 1. 微信登录

**接口**：`POST /api/login/wechat`

**请求体**：
```json
{
  "code": "微信登录凭证",
  "nickName": "用户昵称",
  "avatarUrl": "用户头像URL"
}
```

**响应示例**：
```json
{
  "success": true,
  "message": "登录成功",
  "data": {
    "token": "JWT_TOKEN",
    "openid": "微信用户唯一标识",
    "session_key": "会话密钥",
    "userId": "用户ID"
  }
}
```

**说明**：
- `code` 通过 `wx.login()` 获取
- 后端需调用微信接口 `https://api.weixin.qq.com/sns/jscode2session` 校验 code
- 返回的 `token` 需在后续请求的 Header 中携带

---

## 2. 验证邀请码

**接口**：`GET /api/couple/invite/validate?code={邀请码}`

**请求头**：需携带 `Authorization: Bearer {token}`

**响应示例**：
```json
{
  "success": true,
  "message": "邀请码有效",
  "data": {
    "code": "U9441L",
    "creator": {
      "userId": "用户ID",
      "nickName": "发起方昵称",
      "avatarUrl": "发起方头像"
    },
    "expireAt": "2025-01-16T10:30:00Z"
  }
}
```

**错误响应**：
```json
{
  "success": false,
  "message": "邀请码已过期",
  "errorCode": "INVITE_CODE_EXPIRED"
}
```

**说明**：
- 邀请码为 6 位字母数字组合
- 验证邀请码的有效性和过期时间
- 返回邀请发起方的用户信息

---

## 3. 接受邀请（建立关系）

**接口**：`POST /api/login/invite`

**请求头**：需携带 `Authorization: Bearer {token}`

**请求体**：
```json
{
  "inviteCode": "U9441L",
  "userId": "被邀请用户ID"
}
```

**响应示例**：
```json
{
  "success": true,
  "message": "绑定成功",
  "data": {
    "coupleId": "couple_001",
    "partnerInfo": {
      "userId": "对方用户ID",
      "nickName": "对方昵称",
      "avatarUrl": "对方头像"
    },
    "bindTime": "2025-01-15T11:00:00Z"
  }
}
```

**业务规则**：
- 邀请码必须有效且未过期
- 双方均需处于未绑定状态
- 同一邀请码仅可使用一次

---

## 4. 查询绑定状态

**接口**：`GET /api/couple/status`

**请求头**：需携带 `Authorization: Bearer {token}`

**响应示例**：
```json
{
  "success": true,
  "data": {
    "isBound": true,
    "coupleId": "couple_001",
    "partnerInfo": {
      "userId": "对方用户ID",
      "nickName": "对方昵称",
      "avatarUrl": "对方头像"
    },
    "bindTime": "2025-01-15T11:00:00Z",
    "role": "initiator"
  }
}
```

---

## 常见错误码

| 错误码 | 说明 |
|--------|------|
| `LOGIN_CODE_INVALID` | 微信 code 无效 |
| `LOGIN_CODE_EXPIRED` | 微信 code 过期 |
| `INVITE_CODE_INVALID` | 邀请码不存在 |
| `INVITE_CODE_EXPIRED` | 邀请码过期 |
| `ALREADY_BOUND` | 用户已绑定 |
| `INVITER_ALREADY_BOUND` | 发起方已绑定 |
| `INVITEE_ALREADY_BOUND` | 受邀方已绑定 |

---

## 业务流程

### 登录流程
1. 前端调用 `wx.login()` 获取 `code`
2. 前端调用 `uni.getUserProfile()` 获取用户信息
3. 前端调用 `POST /api/login/wechat` 完成登录
4. 保存返回的 `token` 到本地存储

### 绑定流程
1. 发起方：生成邀请码（`POST /api/couple/invite/create`）
2. 受邀方：验证邀请码（`GET /api/couple/invite/validate?code=xxx`）
3. 受邀方：接受邀请（`POST /api/login/invite`）
4. 双方：查询绑定状态（`GET /api/couple/status`）

