# 邀请功能说明

## 功能概述

本项目实现了基于邀请码的用户邀请和登录功能。用户可以通过邀请码注册并登录系统，每个用户都有唯一的邀请码可以分享给其他人。

## 新增功能

### 1. 更新时间字段
- 为用户表(at_users)添加了updated_at字段，用于记录用户信息的最后更新时间
- 该字段会在每次用户信息更新时自动更新

### 2. 邀请码登录功能
- 新增邀请码登录接口：`POST /api/login/invite`
- 用户可以通过他人的邀请码注册并登录系统
- 系统会为新用户自动生成唯一的6位中英文结合的邀请码

### 3. 邀请码唯一性验证
- 系统确保每个用户生成的邀请码都是唯一的
- 在生成邀请码时会检查数据库中是否已存在相同的邀请码
- 如果生成的邀请码已存在，系统会重新生成直到找到唯一的邀请码

### 4. 情侣邀请码功能
- 新增情侣邀请码生成接口：`POST /api/couple/invite/create`
- 已登录用户可以生成专属的情侣邀请码
- 该邀请码可用于情侣关系绑定

## 接口说明

### 邀请码登录接口

- **接口地址**: `POST /api/login/invite`
- **请求参数**:
  ```json
  {
    "inviteCode": "邀请码",
    "nickName": "用户昵称",
    "avatarUrl": "用户头像URL"
  }
  ```
- **响应结果**:
  ```json
  {
    "code": 200,
    "msg": "登录成功",
    "data": {
      "success": true,
      "message": "登录成功",
      "user": {
        "id": 1,
        "openid": null,
        "sessionKey": null,
        "code": "新生成的6位中英文邀请码",
        "nickName": "用户昵称",
        "avatarUrl": "用户头像URL",
        "createdAt": "2025-11-14T12:00:00",
        "updatedAt": "2025-11-14T12:00:00"
      },
      "token": "JWT令牌"
    }
  }
  ```

### 情侣邀请码生成接口

- **接口地址**: `POST /api/couple/invite/create`
- **请求方式**: POST
- **认证方式**: 需要JWT Token认证
- **响应结果**:
  ```json
  {
    "code": 200,
    "msg": "邀请码生成成功",
    "data": "ABC123"
  }
  ```

## 数据库变更

### at_users表结构更新

新增字段：
- `updated_at`: DATETIME类型，记录用户信息最后更新时间
- `session_key`: VARCHAR(128)类型，存储微信会话密钥
- `code`字段长度更新为VARCHAR(64)，以支持6位中英文邀请码

## 使用流程

1. 已有用户获取自己的邀请码（在用户信息中）
2. 将邀请码分享给朋友
3. 朋友使用邀请码通过`POST /api/login/invite`接口注册并登录
4. 系统为新用户生成唯一的6位中英文邀请码
5. 新用户也可以邀请其他用户
6. 已登录用户可以通过`POST /api/couple/invite/create`生成专属情侣邀请码

## 安全说明

1. 邀请码为6位中英文结合的随机字符串
2. 每个用户拥有唯一的邀请码
3. 系统确保邀请码的唯一性
4. 邀请码登录接口允许匿名访问
5. 情侣邀请码生成接口需要用户认证
6. 用户信息更新时自动更新updated_at字段

## 注意事项

1. 请确保数据库已执行相关脚本更新表结构
2. 邀请码具有唯一性，系统会验证邀请码的有效性
3. 新用户注册时会自动生成新的6位中英文邀请码
4. 系统最多尝试100次生成唯一邀请码，防止无限循环